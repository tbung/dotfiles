local dir
if (( ${+commands[fd]} )); then
    dir=$(fd --hidden --max-depth=2 --prune \^.git$ ${HOME}/Projects -x dirname | fzf -d'/' --with-nth=-1)
else
    dir=$(printf '%s\n' ${HOME}/Projects/*/.git | xargs dirname | fzf -d'/' --with-nth=-1)
fi

if [[ -z "$dir" ]]; then
    zle && zle redisplay
    return 0
fi

if zle; then
    zle push-line
    BUFFER="cd $dir"
    zle accept-line
    local ret=$?
    unset dir
    zle reset-prompt
    return $ret
else
    cd $dir
fi

# vim:ft=zsh
